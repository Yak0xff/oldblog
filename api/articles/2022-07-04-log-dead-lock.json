{"title":"2022-07-04  å…³äºæ­»é”çš„ç®€å•è®°å½•","uid":"e0ae854e6f0229d985990b4529079d67","slug":"2022-07-04-log-dead-lock","date":"2022-07-04T14:21:38.000Z","updated":"2023-05-30T09:56:42.587Z","comments":true,"path":"api/articles/2022-07-04-log-dead-lock.json","keywords":null,"cover":[],"content":"<ul>\n<li><strong>æ­»é”</strong> æŒ‡çš„æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆä¸€ç§ç›¸äº’ç­‰å¾…çš„ç°è±¡ï¼Œå¦‚æœæ— å¤–åŠ›ä½œç”¨ä¸‹ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚</li>\n</ul>\n<p>ä¸¾ä¸ªç®€å•ä¾‹å­ï¼š</p>\n<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¿ç¨‹ A æŒæœ‰èµ„æº 2ï¼Œçº¿ç¨‹ B æŒæœ‰èµ„æº 1ï¼Œä»–ä»¬åŒæ—¶éƒ½æƒ³ç”³è¯·å¯¹æ–¹çš„èµ„æºï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šäº’ç›¸ç­‰å¾…è€Œè¿›å…¥æ­»é”çŠ¶æ€ã€‚</p>\n<p><img src=\"/images/logs/2022-07-04_log.png\" alt=\"æ­»é”å›¾ä¾‹\"></p>\n<ul>\n<li><p><strong>æ­»é”çš„æ¡ä»¶ï¼š</strong></p>\n</li>\n<li><p><strong>äº’æ–¥æ¡ä»¶ï¼š</strong>çº¿ç¨‹å¯¹èµ„æºçš„è®¿é—®æ˜¯æ’ä»–æ€§çš„ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å ç”¨äº†æŸä¸ªèµ„æºï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚</p>\n</li>\n<li><p><strong>ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼š</strong>çº¿ç¨‹åœ¨å·²ç»è·å¾—èµ„æºçš„æƒ…å†µä¸‹ï¼Œæœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨å®Œä¹‹åè‡ªå·±é‡Šæ”¾ã€‚</p>\n</li>\n<li><p>**ä¿æŒå’Œè¯·æ±‚æ¡ä»¶ï¼š **çº¿ç¨‹T1è‡³å°‘å·²ç»ä¿æŒäº†ä¸€ä¸ªèµ„æºR1çš„å ç”¨ï¼ŒåŒæ—¶åˆæå‡ºå¯¹å¦ä¸€ä¸ªèµ„æºR2çš„è¯·æ±‚ï¼Œä½†æ˜¯R2 åˆè¢«å…¶ä»–çº¿ç¨‹T2å ç”¨ï¼Œæ‰€ä»¥çº¿ç¨‹T1å¿…é¡»ç­‰å¾…ï¼Œä½†åˆå¯¹è‡ªå·±ä¿æŒå¯¹R1 ä¸é‡Šæ”¾ï¼Œè€ŒT2åˆå¿…é¡»è¦å¾—åˆ°R1çš„èµ„æºæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p>\n</li>\n<li><p><strong>ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼š</strong>åœ¨æ­»é”å‘ç”Ÿæ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªâ€œçº¿ç¨‹-èµ„æºç¯å½¢é“¾â€ï¼Œå³ï¼š{p0,p1,p2,â€¦pn},è¿›ç¨‹p0ï¼ˆæˆ–çº¿ç¨‹ï¼‰ç­‰å¾…p1å ç”¨çš„èµ„æºï¼Œp1ç­‰å¾…p2å ç”¨çš„èµ„æºï¼Œpnç­‰å¾…p0å ç”¨çš„èµ„æºã€‚</p>\n</li>\n<li><p><strong>é¿å…çº¿ç¨‹æ­»é”ï¼š</strong></p>\n</li>\n</ul>\n<p>é¿å…æ­»é”çš„æ–¹æ¡ˆå¯ä»¥ä»é€ æˆæ­»é”çš„å››ä¸ªæ¡ä»¶å…¥æ‰‹ï¼Œç ´åå¯¼è‡´æ­»é”å¿…è¦æ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªå°±å¯ä»¥é¢„é˜²æ­»é”ï¼š</p>\n<ul>\n<li><strong>ç ´åäº’æ–¥æ¡ä»¶ï¼š</strong>è¿™ä¸ªæ¡ä»¶æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç ´åï¼Œå› ä¸ºæˆ‘ä»¬ç”¨é”æœ¬æ¥å°±æ˜¯æƒ³è®©ä»–ä»¬äº’æ–¥çš„(ä¸´ç•Œèµ„æºéœ€è¦äº’æ–¥è®¿é—®)ã€‚</li>\n<li><strong>ç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼š</strong>ä¸å†åˆ†æ‰¹ç”³è¯·èµ„æºï¼Œä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰çš„èµ„æºã€‚</li>\n<li><strong>ç ´åä¸å‰¥å¤ºæ¡ä»¶ï¼š</strong>å ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æºã€‚</li>\n<li><strong>ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼š</strong>é æŒ‰åºç”³è¯·èµ„æºæ¥é¢„é˜²ã€‚æŒ‰æŸä¸€é¡ºåºç”³è¯·èµ„æºï¼Œé‡Šæ”¾èµ„æºåˆ™ååºé‡Šæ”¾ã€‚ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚å¯¹äºå‰é¢çš„ä¾‹å­å¦‚æœçº¿ç¨‹1ï¼Œçº¿ç¨‹2éƒ½æ˜¯å…ˆç”³è¯·èµ„æº1ï¼Œå†ç”³è¯·èµ„æº2å°±ä¸ä¼šå¯¼è‡´æ­»é”äº†ã€‚</li>\n</ul>\n<p><strong>æ­»é”çš„ä¾‹å­ï¼š</strong></p>\n<pre class=\"line-numbers language-objectivec\" data-language=\"objectivec\"><code class=\"language-objectivec\">NSObject *resource1 &#x3D; [NSObject new];\nNSObject *resource2 &#x3D; [NSObject new];\n\ndispatch_queue_t queue1 &#x3D; dispatch_queue_create(&quot;thread1&quot;, DISPATCH_QUEUE_CONCURRENT);\ndispatch_queue_t queue2 &#x3D; dispatch_queue_create(&quot;thread2&quot;, DISPATCH_QUEUE_CONCURRENT);\n\ndispatch_async(queue1, ^&#123;\n    @synchronized (resource1) &#123;\n        IDLLogInfo(@&quot;queue1è·å–åˆ°èµ„æº1&quot;);\n        sleep(10);\n        IDLLogInfo(@&quot;queue1å°è¯•è·å–èµ„æº2&quot;);\n        @synchronized (resource2) &#123;\n             IDLLogInfo(@&quot;queue1è·å–åˆ°èµ„æº2&quot;);\n         &#125;\n    &#125;\n&#125;);\n    \ndispatch_async(queue2, ^&#123;\n  @synchronized (resource2) &#123;\n      IDLLogInfo(@&quot;queue2è·å–åˆ°èµ„æº2&quot;);\n      sleep(20);\n       IDLLogInfo(@&quot;queue2å°è¯•è·å–èµ„æº1&quot;);\n       @synchronized (resource1) &#123;\n            IDLLogInfo(@&quot;queue2è·å–åˆ°èµ„æº1&quot;);\n       &#125;\n   &#125;\n&#125;);</code></pre>\n\n","text":" æ­»é” æŒ‡çš„æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆä¸€ç§ç›¸äº’ç­‰å¾…çš„ç°è±¡ï¼Œå¦‚æœæ— å¤–åŠ›ä½œç”¨ä¸‹ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚ ä¸¾ä¸ªç®€å•ä¾‹å­ï¼š å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¿ç¨‹ A æŒæœ‰èµ„æº 2ï¼Œçº¿ç¨‹ B æŒæœ‰èµ„æº 1ï¼Œä»–ä»¬åŒæ—¶éƒ½æƒ³ç”³è¯·å¯¹æ–¹çš„èµ„æºï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šäº’ç›¸ç­‰å¾…è€Œè¿›å…¥æ­»é”çŠ¶æ€...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"Logs","slug":"Logs","count":3,"path":"api/categories/Logs.json"}],"tags":[],"toc":"","author":{"name":"Yak-0xff","slug":"yak-0xff","avatar":"/img/avatar.jpg","link":"/","description":"ä¸€ä½ä¸æ»¡ç°çŠ¶ï¼Œå°±çˆ±çæŠ˜è…¾çš„æŠ€æœ¯äºº <br /> ğŸ¤” <b>å‹¿ä»¥äº‹å°è€Œä¸ä¸º</b>","socials":{"github":"https://github.com/zycslog","twitter":"https://twitter.com/zh_robin","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3104676569682525","customs":{}}},"mapped":true,"prev_post":{"title":"2022-07-17  é‡æ„é‚£äº›äº‹","uid":"9f08952be24e03501c17b0dc2ee6bf37","slug":"2022-07-17-log-refactor","date":"2022-07-17T20:30:38.000Z","updated":"2023-05-30T09:56:42.587Z","comments":true,"path":"api/articles/2022-07-17-log-refactor.json","keywords":null,"cover":null,"text":"WHATï¼šä»€ä¹ˆæ˜¯é‡æ„ï¼Ÿ Martin Fowlerï¼šé‡æ„æ˜¯ä¸€ç§å¯¹è½¯ä»¶å†…éƒ¨ç»“æ„çš„æ”¹å–„ï¼Œç›®çš„æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶çš„å¯è§è¡Œä¸ºçš„æƒ…å†µä¸‹ï¼Œä½¿å…¶æ›´æ˜“ç†è§£ï¼Œä¿®æ”¹æˆæœ¬æ›´ä½ã€‚ å¤§å‹é‡æ„ å¯¹è±¡ï¼šå¯¹ç³»ç»Ÿã€æ¨¡å—ã€ä»£ç ç»“æ„ã€ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ç­‰çš„é‡æ„ æ–¹æ³•ï¼šæœ‰åˆ†å±‚å‚ç›´æ‹†åˆ†ã€æ¨¡å—åŒ–æ°´å¹³æ‹†åˆ†ã€è§£è€¦ã€æŠ½è±¡UIç»„ä»¶ã€æŠ½è±¡...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"Logs","slug":"Logs","count":3,"path":"api/categories/Logs.json"}],"tags":[],"author":{"name":"Yak-0xff","slug":"yak-0xff","avatar":"/img/avatar.jpg","link":"/","description":"ä¸€ä½ä¸æ»¡ç°çŠ¶ï¼Œå°±çˆ±çæŠ˜è…¾çš„æŠ€æœ¯äºº <br /> ğŸ¤” <b>å‹¿ä»¥äº‹å°è€Œä¸ä¸º</b>","socials":{"github":"https://github.com/zycslog","twitter":"https://twitter.com/zh_robin","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3104676569682525","customs":{}}}},"next_post":{"title":"2022-04-30","uid":"151a15539ff01fdc8f45662f9abcfbf2","slug":"2022-04-30-log-md","date":"2022-04-30T20:55:38.000Z","updated":"2023-05-30T09:56:42.587Z","comments":true,"path":"api/articles/2022-04-30-log-md.json","keywords":null,"cover":[],"text":" 4æœˆä»½æœ€åä¸€å¤©äº†ï¼Œä¸‹å®šå†³å®šè¦é‡å¯è¿™ä¸ªå°åšå®¢ç½‘ç«™äº†ã€‚æ¥æ¥å›å›å¾ˆå¤šæ¬¡æ— æš‡é¡¾åŠï¼Œä¹Ÿå¯èƒ½æ˜¯è‡ªå·±å¤ªæ‡’äº†å§ï¼Œæ€»ä¹‹ï¼Œåº†ç¥é‡å¯äº†ã€‚ğŸ‘ äº”ä¸€æ”¾å‡ä¹‹å‰ï¼Œæƒ³æ³•å¾ˆå¤šï¼Œä½†æ˜¯çœŸæ­£æ”¾å‡åï¼Œå´è§‰å¾—è¿˜æ˜¯ä¸è¦åˆ°å¤„è·‘åŠ¨äº†ï¼Œä¸–äº‹éš¾æ–™ï¼Œäººç”Ÿæ— å¸¸ï¼Œæ­¤æ—¶åˆ©ç”¨é—²æš‡æ—¶é—´åšç‚¹ä¸€ç›´æ²¡æœ‰æ—¶é—´å»åšçš„äº‹æƒ…ï¼Œä¹Ÿä¸ä¹æ˜¯ä¸ªç¾å¥½çš„å‡æœŸã€‚ ","link":"","photos":[],"count_time":{"symbolsCount":138,"symbolsTime":"1 mins."},"categories":[{"name":"Logs","slug":"Logs","count":3,"path":"api/categories/Logs.json"}],"tags":[],"author":{"name":"Yak-0xff","slug":"yak-0xff","avatar":"/img/avatar.jpg","link":"/","description":"ä¸€ä½ä¸æ»¡ç°çŠ¶ï¼Œå°±çˆ±çæŠ˜è…¾çš„æŠ€æœ¯äºº <br /> ğŸ¤” <b>å‹¿ä»¥äº‹å°è€Œä¸ä¸º</b>","socials":{"github":"https://github.com/zycslog","twitter":"https://twitter.com/zh_robin","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3104676569682525","customs":{}}}}}